/* (c) 2019 ClassCube - https://classcube.com */

!function(){var o=wp.i18n.__,c=wp.element.createElement,e=wp.blocks.registerBlockType;wp.blocks.InspectorControls,wp.blocks.ToggleControl,wp.blocks.BlockControls;e("classcube/mathjax-block",{title:o("MathJax","classcube-mathjax-block"),icon:"media-code",category:"common",description:o("Insert math equations into your posts using MathJax","classcube-mathjax-block"),attributes:{mathjax:{default:""},imagedata:{default:""}},supports:{html:!1,reusable:!0},edit:function(t){var e=wp.element.createElement,a=e("div",{contentEditable:!0,onInput:function(e){ccMathJax.pngSetDataUrl(jQuery("#block-"+t.clientId).find("div[contentEditable]").html(),jQuery('img[data-preview-id="'+t.clientId+'"]'))}},""),n=c("img",{"data-preview-id":t.clientId}),i=c("div",{"data-preview-id":t.clientId,style:{display:"none"}},o("The equation is either blank or has an error","classcube-mathjax-block"));return e("div",{},a,c("div",{},n,i),c("img",{src:"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",onLoad:function(e){jQuery("#block-"+t.clientId).focus(function(){jQuery(this).find("[contentEditable]").focus()})}}))},save:function(e){return null}})}();console.info(window.MathJax);var ccMathJax={pngSetDataUrl:function(e,t){e=e.trim().replace(/<br\s*\/*>/gi,"\n ").replace(/(<(p|div))/gi,"\n $1").replace(/(<([^>]+)>)/gi,"");this.setupMathJax();var a=jQuery(t).data("previewId");this.tex2img(e,function(e){if(""==e||"data:,"==e){jQuery(t).hide();jQuery('div[data-preview-id="'+a+'"]').show()}else{jQuery('div[data-preview-id="'+a+'"]').hide();jQuery(t).show();jQuery(t).attr("src",e)}});this.resetMathJax()},tex2img:function(e,n){MathJax.Hub.Config({SVG:{useGlobalCache:!1}});MathJax.Hub.Queue(function(){var a=MathJax.HTML.Element("span",{},e);MathJax.Hub.Typeset(a,function(){var e=a.getElementsByTagName("svg");if(e.length){e[0].setAttribute("xmlns","http://www.w3.org/2000/svg");var t=new Image;t.src="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(e[0].outerHTML)));t.onload=function(){var e=document.createElement("canvas");e.width=2*t.width;e.height=2*t.height;e.getContext("2d").drawImage(t,0,0,2*t.width,2*t.height);n(e.toDataURL("image/png"))}}else n("")})})},setupMathJax:function(){window.MathJax},resetMathJax:function(){}};