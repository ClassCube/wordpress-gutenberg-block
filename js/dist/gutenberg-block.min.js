/* (c) 2019 ClassCube - https://classcube.com */

!function(){var r=wp.i18n.__,s=wp.element.createElement;(0,wp.blocks.registerBlockType)("classcube/mathjax-block",{title:r("MathJax","classcube-mathjax-block"),icon:"media-code",category:"common",description:r("Insert math equations into your posts using MathJax","classcube-mathjax-block"),attributes:{mathjax:{default:""},divContents:{default:""},imageData:{default:""}},supports:{html:!1,reusable:!0},edit:function(t){var e=wp.element.createElement,a=e("div",{contentEditable:!0,className:"cc-equation-editor",onInput:function(e){ccMathJax.pngSetDataUrl(jQuery("#block-"+t.clientId).find("div[contentEditable]").html(),jQuery('img[data-preview-id="'+t.clientId+'"]'),t)}},""),i=s("img",{"data-preview-id":t.clientId}),n=s("div",{"data-preview-id":t.clientId,"data-preview":"error",style:{display:"none"}},r("The equation is either blank or has an error","classcube-mathjax-block"));return e("div",{},a,s("div",{"data-preview-id":t.clientId,"data-preview":"wrapper",className:"cc-mathjax-preview-wrapper"},i,n),s("img",{src:"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",onLoad:function(e){jQuery("#block-"+t.clientId).find(".cc-equation-editor").html(t.attributes.divContents);jQuery("#block-"+t.clientId).focus(function(){jQuery(this).find("[contentEditable]").focus()});ccMathJax.pngSetDataUrl(jQuery("#block-"+t.clientId).find("div[contentEditable]").html(),jQuery('img[data-preview-id="'+t.clientId+'"]'),t)}}))},save:function(e){return null}})}();window.MathJax={jax:["input/TeX","output/SVG"],extensions:["tex2jax.js","MathMenu.js","MathZoom.js"],showMathMenu:!1,showProcessingMessages:!1,messageStyle:"none",SVG:{useGlobalCache:!1},TeX:{extensions:["AMSmath.js","AMSsymbols.js","autoload-all.js"]},tex2jax:{ignoreClass:"cc-equation-editor"},skipStartupTypeset:!0};var ccMathJax={pngSetDataUrl:function(e,t,a){a.setAttributes({divContents:e});e=e.trim().replace(/<br\s*\/*>/gi," ").replace(/(<(p|div))/gi," $1").replace(/(<([^>]+)>)/gi,"").replace(/&nbsp;/gi," ").replace(/&amp;/gi,"&");a.setAttributes({mathjax:e});this.setupMathJax();var i=jQuery(t).data("previewId");this.tex2img(e,function(e){a.setAttributes({imageData:e});console.info(jQuery('div[data-preview-id="'+i+'"]'));if(""==e||"data:,"==e){jQuery(t).hide();jQuery('div[data-preview-id="'+i+'"][data-preview="error"]').show()}else{jQuery('div[data-preview-id="'+i+'"][data-preview="error"]').hide();jQuery(t).show();jQuery(t).attr("src",e)}});this.resetMathJax()},tex2img:function(e,i){MathJax.Hub.Queue(function(){var a=MathJax.HTML.Element("span",{},e);MathJax.Hub.Typeset(a,function(){var e=a.getElementsByTagName("svg");if(e.length){e[0].setAttribute("xmlns","http://www.w3.org/2000/svg");var t=new Image;t.src="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(e[0].outerHTML)));t.onload=function(){var e=document.createElement("canvas");e.width=2*t.width;e.height=2*t.height;e.getContext("2d").drawImage(t,0,0,2*t.width,2*t.height);i(e.toDataURL("image/png"))}}else i("")})})},setupMathJax:function(){window.MathJax},resetMathJax:function(){}};